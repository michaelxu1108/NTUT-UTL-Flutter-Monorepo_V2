# CSV 匯出狀態改善 - 測試指南

## 🎯 測試目標

驗證新的狀態顯示功能是否正常運作，確保用戶能清楚看到：
1. 錄製中的狀態
2. 製作 CSV 的進度
3. 下載完成的通知

---

## 🔧 測試前準備

### 1. 確認 Mock 模式已開啟

在 `lib/main.dart` 中確認：

```dart
const bool useMockData = true;  // ← 確保為 true
```

✅ **已設定好**，無需修改

### 2. 執行 App

```bash
cd apps/utl_amulet
flutter run
```

---

## 📝 測試流程

### 測試 1：完整錄製流程 ⭐

**目的**: 驗證所有 4 種狀態的轉換

**步驟**:

1. **啟動 App**
   - ✅ 檢查：右側控制面板顯示「閒置中」（灰色）
   - ✅ 檢查：按鈕顯示「開始記錄數據」（綠色按鈕）

2. **點擊「開始記錄數據」**
   - ✅ 檢查：狀態立即切換為「錄製中」（綠色背景）
   - ✅ 檢查：圖示變為紅色圓點 🔴
   - ✅ 檢查：按鈕文字變為「停止記錄並匯出 CSV」（紅色按鈕）
   - ✅ 檢查：下方顯示灰色提示文字
   - ✅ 檢查：左側圖表開始顯示資料波形

3. **等待約 3-5 秒**（讓它錄一些資料）
   - ✅ 檢查：圖表持續更新
   - ✅ 檢查：狀態保持為「錄製中」

4. **點擊「停止記錄並匯出 CSV」**
   - ✅ 檢查：狀態**立即**切換為「製作 CSV 中」（橙色背景）
   - ✅ 檢查：圖示變為沙漏 ⏳ **並有轉圈動畫**
   - ✅ 檢查：按鈕文字變為「處理中...」（灰色按鈕）
   - ✅ 檢查：**按鈕無法點擊**（禁用狀態）
   - ✅ 檢查：圖表已清空

5. **等待 CSV 生成完成**（約 1-2 秒）
   - ✅ 檢查：狀態自動切換為「下載完成」（藍色背景）
   - ✅ 檢查：圖示變為勾選 ✅
   - ✅ 檢查：**彈出成功對話框**（綠色標題）
   - ✅ 檢查：對話框標題為「下載 CSV 完成」
   - ✅ 檢查：對話框內容說明 CSV 已儲存
   - ✅ 檢查：狀態區塊下方顯示藍色提示「✅ CSV 檔案已成功儲存...」
   - ✅ 檢查：按鈕變為「開始記錄數據」（綠色按鈕，可點擊）

6. **點擊對話框的「確定」**
   - ✅ 檢查：對話框關閉
   - ✅ 檢查：狀態**仍然**顯示「下載完成」（藍色）
   - ✅ 檢查：提示文字仍然顯示

7. **點擊「開始記錄數據」**
   - ✅ 檢查：狀態重置為「閒置中」（灰色）
   - ✅ 檢查：然後立即切換為「錄製中」（綠色）
   - ✅ 檢查：開始新的錄製

---

### 測試 2：處理中無法操作 ⭐

**目的**: 驗證「製作 CSV 中」時無法點擊按鈕

**步驟**:

1. 開始錄製 → 等待 3 秒 → 點擊停止
2. **在狀態為「製作 CSV 中」時**：
   - ✅ 檢查：按鈕顯示為灰色
   - ✅ 檢查：點擊按鈕**無反應**
   - ✅ 檢查：沙漏圖示持續轉動
3. 等待 CSV 完成
   - ✅ 檢查：按鈕自動變為可點擊

---

### 測試 3：快速連續操作

**目的**: 驗證快速點擊不會造成狀態錯亂

**步驟**:

1. 點擊「開始」→ 立即點擊「停止」
   - ✅ 檢查：狀態正常轉換
   - ✅ 檢查：對話框正常彈出

2. 關閉對話框 → 立即點擊「開始」→ 立即點擊「停止」
   - ✅ 檢查：狀態轉換流暢
   - ✅ 檢查：沒有錯誤

---

### 測試 4：視覺效果驗證

**目的**: 確認所有視覺元素正確顯示

**檢查清單**:

#### 閒置中
- ⭕ 圖示：⭕（空心圓）
- 🎨 背景：灰色
- 🎨 邊框：淺灰色
- 🎨 文字：灰色
- 🔘 按鈕：綠色「開始記錄數據」

#### 錄製中
- 🔴 圖示：🔴（紅色實心圓）
- 🎨 背景：淺綠色
- 🎨 邊框：綠色
- 🎨 文字：深綠色
- 🔘 按鈕：紅色「停止記錄並匯出 CSV」
- 📝 提示：灰色小字提示

#### 製作 CSV 中
- ⏳ 圖示：⏳（轉圈動畫）
- 🎨 背景：淺橙色
- 🎨 邊框：橙色
- 🎨 文字：深橙色
- 🔘 按鈕：灰色「處理中...」（禁用）
- ⚠️ **重點**：轉圈動畫要持續轉動

#### 下載完成
- ✅ 圖示：✅（勾選符號）
- 🎨 背景：淺藍色
- 🎨 邊框：藍色
- 🎨 文字：深藍色
- 🔘 按鈕：綠色「開始記錄數據」
- 📝 提示：藍色「✅ CSV 檔案已成功儲存...」
- 💬 對話框：成功對話框（綠色標題欄）

---

## 📊 預期結果

### ✅ 成功標準

1. **狀態轉換正確**
   - 閒置中 → 錄製中 → 製作 CSV 中 → 下載完成 → 閒置中

2. **視覺反饋明確**
   - 4 種狀態有明顯的顏色區分
   - 轉圈動畫流暢
   - 對話框正常彈出

3. **按鈕邏輯正確**
   - 處理中時按鈕禁用
   - 下載完成時按鈕可點擊
   - 點擊開始後狀態正確重置

4. **通知持久**
   - 對話框不會自動消失
   - 「下載完成」狀態持續顯示直到開始新錄製

### ❌ 失敗情況

如果出現以下情況，代表有 bug：

1. **狀態跳過**
   - 錄製中 → 直接變為閒置中（跳過製作 CSV）
   - 錄製中 → 直接變為下載完成（跳過製作 CSV）

2. **按鈕異常**
   - 製作 CSV 時仍可點擊按鈕
   - 下載完成後按鈕仍顯示「處理中」

3. **視覺問題**
   - 轉圈動畫不會轉
   - 顏色沒有變化
   - 對話框沒有彈出

4. **通知問題**
   - 沒有彈出對話框
   - 對話框自動消失

---

## 🐛 問題回報格式

如果發現問題，請提供以下資訊：

```
問題描述：
[描述看到什麼問題]

重現步驟：
1. [步驟 1]
2. [步驟 2]
3. [問題發生]

預期行為：
[應該要怎樣]

實際行為：
[實際發生什麼]

截圖：
[如果可能，提供截圖]

環境：
- 平台：[Android/iOS/Web]
- 裝置：[裝置型號]
- Flutter 版本：[執行 flutter --version]
```

---

## 📷 測試截圖檢查點

建議在以下時機截圖：

1. **閒置中** - 初始畫面
2. **錄製中** - 有資料波形
3. **製作 CSV 中** - 有轉圈動畫（重點！）
4. **完成對話框** - 對話框彈出的畫面
5. **下載完成** - 對話框關閉後的狀態

---

## ✨ 改善驗證

### 對比原始問題

根據用戶原始反映的 PDF 文件：

| 原始問題 | 改善後 | 驗證方式 |
|---------|--------|---------|
| ❌ 錄完後直接回到「閒置中」 | ✅ 顯示「製作 CSV 中」 | 點擊停止後立即觀察狀態 |
| ❌ 不知道還在製作 CSV | ✅ 橙色背景 + 轉圈動畫 | 確認有轉圈動畫 |
| ❌ Toast 一閃就消失 | ✅ 對話框 + 持久狀態 | 對話框需手動關閉 |
| ❌ 不知道檔案處理好沒 | ✅ 「下載完成」持續顯示 | 關閉對話框後狀態仍保持 |

---

## 🎉 測試完成

當所有測試項目都通過 ✅ 時，代表功能正常！

如果有任何測試項目失敗 ❌，請記錄問題並回報。

---

**測試文件版本**: 1.0
**建立日期**: 2026-01-05
**適用版本**: utl_amulet v1.0.0+
